# Aircraft Cargo Auto Balance System

### Authorï¼šYu Qiao & Yuhan Liu

<p align="center">
    <img alt="logo" src="https://i.postimg.cc/HL5pVSkN/icon.png" width="150" height="150" style="margin-bottom: 10px;">
</p>

<p align="center">
<svg style="width:12px;height:12px;" t="1706099735946" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19568" width="200" height="200"><path d="M905.386667 226.133333L562.517333 28.842667c-31.744-18.773333-71.68-18.773333-102.912 0L117.589333 226.133333c-31.744 18.773333-51.882667 52.394667-51.882666 89.770667v395.434667c0 36.864 19.626667 70.485333 51.882666 89.770666L459.434667 998.4c15.701333 9.045333 33.28 13.653333 51.882666 13.653333 18.090667 0 35.84-5.12 51.882667-13.653333l342.357333-197.290667c31.744-18.773333 51.882667-52.394667 51.882667-89.770666V315.733333c-1.024-36.693333-20.821333-71.509333-52.053333-89.6z m-12.117334 484.010667c0 14.677333-7.509333 27.136-20.138666 34.816L531.114667 942.592c-12.117333 6.997333-27.136 6.997333-40.448 0L148.821333 744.96c-12.117333-6.997333-19.626667-20.138667-19.626666-34.816V315.733333c0-14.677333 7.509333-27.136 19.626666-34.816L491.349333 83.285333c5.973333-3.584 12.970667-5.461333 19.626667-5.461333 6.997333 0 13.653333 1.536 19.626667 5.461333l342.357333 197.290667c12.117333 6.997333 19.626667 20.138667 19.626667 34.816v394.410667l0.682666 0.341333z" fill="#1296db" p-id="19569"></path><path d="M469.411919 737.437712a25.6 39.936 31.185 1 0 41.357966-68.330484 25.6 39.936 31.185 1 0-41.357966 68.330484Z" fill="#1296db" p-id="19570"></path><path d="M609.949482 664.238808a25.6 39.936 31.185 1 0 41.357966-68.330484 25.6 39.936 31.185 1 0-41.357966 68.330484Z" fill="#1296db" p-id="19571"></path><path d="M733.489691 596.07907a25.6 39.936 31.185 1 0 41.357966-68.330484 25.6 39.936 31.185 1 0-41.357966 68.330484Z" fill="#1296db" p-id="19572"></path><path d="M646.144 241.152l-1.194667 0.512 1.194667-0.512-232.96 141.994667v117.76l-61.610667-39.253334v-112.981333l232.106667-141.824 0.853333-0.512-13.141333-7.338667-62.464-35.328-228.864 136.362667v207.36l206.165333 128 225.962667-132.266667V278.528z" fill="#1296db" p-id="19573"></path><path d="M712.362667 419.84v26.112l111.274666 61.44v90.453333L475.989333 788.309333c-10.24 5.632-22.698667 5.290667-32.597333-0.853333l-229.717333-140.288c-12.970667-7.850667-18.773333-23.893333-13.824-37.888 10.069333-28.672 32.256-50.858667 51.370666-65.536v-28.16c-23.381333 15.530667-58.368 44.544-73.045333 86.016-8.533333 24.234667 1.365333 51.541333 23.552 65.024l229.717333 140.288c8.874667 5.461333 18.773333 8.021333 28.842667 8.021333 9.216 0 18.261333-2.218667 26.624-6.826666L846.506667 611.498667v-117.589334L712.362667 419.84z" fill="#1296db" p-id="19574"></path><path d="M558.762667 192l110.592 62.122667-34.304 8.362666-122.197334-64.682666 25.088-4.437334z" fill="#1296db" p-id="19575"></path></svg>
  ðŸ‡¬ðŸ‡§ <a href="README.md">English</a>
  &nbsp;
  ðŸ‡¨ðŸ‡³ <a href="README.zh_CN.md">Chinese</a>
</p>

## Project Introduction
In modern aviation logistics, effective management of aircraft cargo balance is crucial for ensuring flight safety and fuel efficiency. An imbalanced load can increase fuel consumption and may impact the aircraft's flight performance and safety. Faced with this challenge, the "Aircraft Cargo Auto Balance System" was conceived to provide an automated, efficient solution for optimizing the distribution and balance of aircraft cargo.
<p align="center">
    <img alt="Overview" src="https://i.postimg.cc/zfb8qf9Y/IMG-4687.avif" width="100%">
    <img alt="Overview" src="https://i.postimg.cc/KvxGtxgt/IMG-4689.avif" width="100%">
</p>

## Motivation
The inspiration for this project stems from the growing demand for aircraft cargo management systems in the market, as well as the limitations of existing solutions. By employing the latest sensor technologies and advanced data processing algorithms, the "Aircraft Cargo Auto Balance System" aims to offer a solution that is more accurate and reliable than traditional manual balancing methods.

## Project Members

| Name      | Email                                   | Contribution                                       | GitHub                              |
| --------- | --------------------------------------- | -------------------------------------------------- | ----------------------------------- |
| Yu Qiao | [2908983Q@student.gla.ac.uk](mailto:2908983Q@student.gla.ac.uk)        | Responsible for the overall project software framework design, front-end overall development, hardware development | [qiaoyu113](https://github.com/qiaoyu113)    |
| Yuhang Liu | [2859549l@student.gla.ac.uk](mailto:yuhanliu123@outlook.com) | Responsible for the overall hardware framework design of the project, hardware and software development | [yuhanliu123](https://github.com/yuhanliu123)    |
| Yiling Deng | [2840572D@student.gla.ac.uk](mailto:2840572D@student.gla.ac.uk) | ... | [YiLingDeng-97](https://github.com/YiLingDeng-97)    |
| Chanzhang He | [2949931H@student.gla.ac.uk](mailto:2949931H@student.gla.ac.uk) | ... | [zzzzzlian](https://github.com/zzzzzlian)    |


## Key Features
1. **Cargo Management:** Provides an intuitive interface for users to easily add, remove, and edit cargo information on the airplane.
2. **Balance Calculation:** Based on the aircraft model and cargo distribution, calculates the aircraft's center of gravity and balance conditions, ensuring a reasonable balance at various flight stages.
3. **Report Generation:** Generates detailed balance reports, including center of gravity charts, load charts, etc., for reference by pilots and ground personnel.

## Technical Architecture
1. **Raspberry Pi**
   - **Sensor Interface:** Connects sensors through GPIO interfaces to real-time retrieve cargo weight data.
   - **Data Processing:** Uses C++ for data processing, calculating balance conditions and generating weight heatmaps.
   - **Local Area Network Server:** The system utilizes tunneling to map a public network address to a local IP, thereby enabling web frontend access via the public network address. This setup facilitates a WebSocket connection, allowing for real-time API access by both GPIO components and the web frontend.

2. **GPIO Microcontroller**
   - **Connection to Raspberry Pi:** The hardware interfaces with the Raspberry Pi via GPIO connections. Once connected, communication with the hardware is managed through mutual exclusion locks, allowing for on-demand communication based on specific needs and commands.
   - **Conveyor Control:** Controls the conveyor belt motor to achieve real-time balance adjustments.
   - **Sensor Interface:** Connects to cargo sensors to obtain real-time cargo position information.

3. **Web Frontend**
   - **Frontend Interface:** Built with Vue to create a user-friendly interface displaying real-time cargo balance status and weight heatmaps.
   - **Communication with Raspberry Pi:** Uses WebSocket to fetch real-time data from the Raspberry Pi.
   - **User Display:** Utilizes real-time readings from the weight sensors to provide feedback to the frontend, offering users a more intuitive view of the balance through heat distribution maps and balance values.

## Project Video Display
[![Watch the video](https://i.postimg.cc/mgnRSrL6/IMG-4691-2.jpg)](https://www.youtube.com/watch?v=BFPnpCT8uog)

## Installation tutorial
<p>
:exclamation: Backend: <a href="backend/readme.md">Raspberry PI environment installation address</a>
</p>
<p>
:exclamation: Web: <a href="web/README.md">Web environment installation address</a>
</p>

## 3D Model Design
<p align="center">
    <img alt="Overview" src="https://i.postimg.cc/4dwDQj0w/IMG-4698.jpg" width="100%">
</p>

To ensure precise cargo weight measurement and balance, we have developed a detailed 3D model. This model includes five smaller weighing plates, which are crucial for the individual measurement of cargo weight. These plates are connected to force sensors, capturing the exact weight of the cargo. To guarantee stability and accuracy in measurement, a larger plate has been designed to be affixed at the center bottom of the conveyor belt. This larger plate not only acts as a support structure for the weighing plates but also serves to connect the force sensors, ensuring accurate transmission of the cargo's gravitational information. The entire assembly is securely mounted on the conveyor belt, maintaining the stability of the system and ensuring real-time monitoring and balancing of cargo weight during transit.

This 3D design is an indispensable part of our project, detailing the assembly and working principles of the weighing system. It serves as an important reference for understanding and implementing our cargo balance system.

## Overview Projects
The Aircraft Cargo Auto Balance System is engineered with precision to ensure seamless integration and communication between its components. The heart of the system is a Raspberry Pi, which serves as the central processing unit, orchestrating the flow of commands and data.
<p align="center">
    <img alt="Overview" src="https://i.postimg.cc/wvkPNz0Y/Wechat-IMG4222.png" width="100%">
</p>

- **Raspberry Pi:** This compact yet powerful board is the command center of our system. It is directly connected to a breadboard that hosts an array of critical components.

- **Load Cells:** Attached to the Raspberry Pi via a set of HX711 amplifiers are multiple load cells. These precision instruments are responsible for measuring the weight of cargo, relaying this data back to the Raspberry Pi for processing.

- **Stepper Motor**: The stepper motor, driven by a TB6600 microstep driver, translates the Raspberry Pi's commands into mechanical movement. This setup is vital for adjusting the conveyor belt's position, ensuring that cargo is balanced correctly within the aircraft.

- **Power Supply:** A robust sealed lead-acid battery supplies the necessary power to the motor driver, ensuring reliable and continuous operation of the system's moving parts.

- **GPIO Connections:** The Raspberry Pi leverages its GPIO pins to establish a direct line of communication with the HX711 amplifiers. This facilitates a high-speed data bus, which is critical for real-time weight sensing and balance adjustments.

- **Mutual Exclusion Locks:** To maintain data integrity and communication efficiency, mutual exclusion locks are implemented. These locks manage the access to the Raspberry Pi's resources, ensuring that each communication instance is handled without interference.

- **Communication Protocols:** The system employs a mix of serial communication and other custom protocols designed to optimize the communication speed and reliability between the Raspberry Pi and the hardware components.

<p align="center">
    <img alt="Overview" src="https://i.postimg.cc/c1FZ2H1h/Wechat-IMG5038.png" width="100%">
</p>

Our projectâ€™s software architecture is meticulously designed to support complex operations while ensuring high maintainability and scalability. Key components include the Controller, WebSocketSession, the WeightSensor interface with its implementations, and the MotorDriver. These components work together to fulfill the system's operational requirements.

Within the system, the Controller class plays a pivotal role in coordinating sensor readings and motor control. It retrieves weight data through implementations of the WeightSensor interface and decides how to operate the MotorDriver to adjust load balancing. This not only exemplifies the Single Responsibility Principle but also centralizes the system's business logic clearly.

The WebSocketSession class manages real-time communication with the frontend, providing real-time data updates to the user interface and receiving commands from it. The design of this class is straightforward, ensuring efficient and reliable communication with the frontend. By employing callback mechanisms, the system can respond immediately to new data or commands, enhancing the interactivity's real-time nature.

Sensor logic is abstracted through the WeightSensor interface, allowing the system to support various types of sensors without modifying the control logic, illustrating the Open/Closed Principle and Liskov Substitution Principle. Each specific sensor class, like HX711Sensor, implements this interface, ensuring flexibility and scalability in sensor replacement. Callback functions are extensively used during sensor data retrieval, allowing immediate processing of ready data without the need for polling, thus optimizing performance and response speed.

The MotorDriver class is responsible for the specific motor control logic, with methods to start, stop, and adjust motor operations. This class's design permits future expansions in motor types or control strategies while avoiding direct coupling between high-level business logic and low-level hardware operations, adhering to the Dependency Inversion Principle.

Interactions within the system are facilitated through clean and focused interfaces, minimizing direct dependencies between modules for ease of understanding and maintenance. Moreover, effective memory management strategies and multithreading safety measures ensure the application's performance and stability.

Through these design and implementation strategies, the project not only follows SOLID principles but also ensures the overall efficacy and sustainable future development of the system architecture. The extensive use of callbacks enables the system to handle real-time data and user interactions efficiently in an event-driven manner, enhancing overall response speed and user experience.

<p align="center">
    <img alt="Overview" src="https://i.postimg.cc/KvSgWF7w/Wechat-IMG3760.png" width="100%">
</p>

The image illustrates a sophisticated user interface of the Aircraft Cargo Balance System, showcasing the seamless translation of intricate hardware sensor data into an intuitive and visually engaging display.

- **Gravity Balance Visualization:** This part of the interface presents a 3D bar graph that dynamically represents the aircraft's cargo weight distribution in real-time. Each bar's height indicates the weight measured by the corresponding load cell, providing a visual representation of the aircraft's center of gravity. This feature offers users an immediate visual cue to the balance status, enabling quick adjustments as necessary.

- **Conveyor Status Indicators:** These indicators deliver at-a-glance insights into the operational status of the conveyor system. The icons switch between different statesâ€”such as idle, running, or alertâ€”to inform the user of the current functioning condition. This real-time status update ensures that users are promptly notified of any issues requiring attention.

- **Balance Rating Dial:** The balance rating is depicted as a dial gauge, giving users an analog visualization of the aircraft's lateral balance. It offers a quick reference to whether the aircraft leans towards the left or right side, and how significant the imbalance is. 

## Project Framework and Structure
```
Aircraft_Cargo_Balance_System/
|-- backend/                            # Backend application code
|   |-- app/                            # Application logic
|   |   |-- balance_rate/               # Balance rate calculations and adjustments
|   |   |   |-- balance_rate.cpp        # Manages the rate of balance adjustments
|   |   |   |-- balance_rate.hpp        # Header file for balance rate functions
|   |   |-- controller/                 # Controller logic
|   |   |   |-- controller_lod.cpp      # Logic for Level of Detail in controller
|   |   |   |-- controller_lod.hpp      # Header file for controller Level of Detail
|   |   |   |-- controller.cpp          # Implementation of primary controller logic
|   |   |   |-- controller.hpp          # Header file for controller interface
|   |   |-- conveyor_status/            # Conveyor status checks
|   |   |   |-- conveyor_status.cpp     # Implementation of conveyor status
|   |   |   |-- conveyor_status.hpp     # Header file for conveyor status
|   |   |-- led_control/                # LED control logic
|   |   |   |-- button.cpp              # Button interactions for LEDs
|   |   |   |-- button.hpp              # Header for button control
|   |   |   |-- led.cpp                 # LED behavior logic
|   |   |   |-- led.hpp                 # Header for LED operations
|   |   |   |-- main.cpp                # Entry point for LED module
|   |   |-- motor_driver/               # Motor driver management
|   |   |   |-- motor/                  # Motor control implementations
|   |   |   |-- motor_driver/           # Motor driver specific files
|   |   |   |-- motor_driver_main.cpp   # Main logic for the motor driver module
|   |   |   |-- motor_driver.cpp        # Manages motor driving operations
|   |   |   |-- motor_driver.hpp        # Header file for motor driver functions
|   |   |-- stepping_motor/             # Stepper motor control
|   |   |   |-- alarm/                  # Alarm management for stepper motor
|   |   |   |   |-- alarm.cpp           # Manages the alarm feature
|   |   |   |   |-- alarm.hpp           # Header for the alarm feature
|   |   |   |-- left/                   # Left movement control
|   |   |   |   |-- left.cpp            # Left movement logic
|   |   |   |   |-- left.hpp            # Header for left movement
|   |   |   |-- pause/                  # Pause functionality
|   |   |   |   |-- pause.cpp           # Pause logic
|   |   |   |   |-- pause.hpp           # Header for pause control
|   |   |   |-- right/                  # Right movement control
|   |   |   |   |-- right.cpp           # Right movement logic
|   |   |   |   |-- right.hpp           # Header for right movement
|   |   |-- weight_reader/              # Weight reader module
|   |   |   |-- weight_reader.cpp       # Implementation for the weight reader module
|   |   |   |-- weight_reader.hpp       # Header file for the weight reader module
|   |   |-- weight_sensor/              # Weight sensor management
|   |       |-- hx711_sensor/           # HX711 weight sensor logic
|   |       |   |-- hx711_sensor.cpp    # Implementation for the HX711 weight sensor
|   |       |   |-- hx711_sensor.hpp    # Header file for HX711 weight sensor
|   |       |-- WeightSensor/           # High-level weight sensor operations
|   |       |   |-- WeightSensor.cpp    # Manages weight sensor operations
|   |       |   |-- WeightSensor.hpp    # Header file for WeightSensor class
|   |       |-- main.cpp                # Main entry point for weight sensor module
|   |-- build/                          # Build-related files
|   |   |-- CMakeFiles/                 # Generated by CMake
|   |   |-- cmake_install.cmake         # CMake installation script
|   |   |-- CMakeCache.txt              # CMake cache file
|   |   |-- Makefile                    # Generated Makefile for the project
|   |-- include/                        # Header files for backend
|   |   |-- AbstractScale.h             # Abstract definition for scales
|   |   |-- AdvancedHX711.h             # Advanced operations for HX711 sensor
|   |   |-- common.h                    # Common definitions and functions
|   |   |-- GpioException.h             # Exception handling for GPIO operations
|   |   |-- HX711.h                     # Base HX711 sensor class definitions
|   |   |-- IntegrityException.h        # Exception for integrity checks
|   |   |-- Mass.h                      # Definitions for mass measurements
|   |   |-- SimpleHX711.h               # Simplified operations for HX711 sensor
|   |   |-- TimeoutException.h          # Exception handling for timeouts
|   |   |-- Utility.h                   # Utility functions
|   |   |-- Value.h                     # Value representation definitions
|   |   |-- ValueStack.h                # Stack implementation for value storage
|   |   |-- Watcher.h                   # Watcher pattern implementation
|   |-- socket/                         # Socket communication logic
|   |   |-- gpio_lock.hpp               # Header for GPIO locking mechanisms
|   |   |-- main.cpp                    # Main logic for socket communication
|   |   |-- send_message.cpp            # Logic to send messages via sockets
|   |   |-- send_message.hpp            # Header file for message sending functions
|   |   |-- server.cpp                  # Server-side socket communication handling
|   |   |-- websocket_session/          # Websocket session management
|   |       |-- websocket_session_button.cpp  # Manages button-related websocket sessions
|   |       |-- websocket_session_button.hpp  # Header for button websocket sessions
|   |       |-- websocket_session_main.cpp   # Main logic for websocket sessions
|   |       |-- websocket_session_main.hpp   # Header for main websocket session logic
|   |       |-- websocket_session.cpp        # Generic websocket session management
|   |       |-- websocket_session.hpp        # Header for websocket session definitions
|   |-- tests/                           # Unit tests for the backend
|   |   |-- motor_driver_test.cpp        # Tests for the motor driver module
|   |   |-- weight_sensor_test.cpp       # Tests for weight sensor functionality
|   |-- utils/                           # Utility functions and classes
|   |   |-- __init__.cpp                 # Initializes the utility module
|   |   |-- calculations.cpp             # Various calculation functions
|   |-- CMakeLists.txt                   # CMake build configuration
|   |-- readme.md                        # Backend documentation
|-- web/                            # Frontend application code (No changes made to this part)
|   |-- node_modules/                    # npm dependencies
|   |-- public/                          # Public assets
|   |-- src/                             # Source code
|   |   |-- assets/                      # Static assets like images, fonts, etc.
|   |   |-- components/                  # Vue components
|   |   |   |-- echart/                  # Chart components
|   |   |   |   |-- bottom/              # Bottom chart components
|   |   |   |   |   |-- conveyorChart.vue  # Conveyor chart component
|   |   |   |   |-- balance.vue            # Balance display component
|   |   |   |   |-- light.vue              # Light control component
|   |   |-- router/                        # Routing configuration
|   |   |   |-- index.js                   # Router setup
|   |   |-- store/                         # Vuex store
|   |   |   |-- index.js                   # Store definition
|   |   |-- views/                         # Vue page components
|   |       |-- index.vue                  # Main component
|   |       |-- simulation.vue             # Simulation view component
|   |       |-- status.vue                 # Status view component
|   |-- App.vue                            # Main Vue application component
|   |-- main.js                            # Entry point for Vue application
|   |-- .gitignore                         # Specifies intentionally untracked files to ignore
|   |-- babel.config.js                    # Configuration for Babel
|   |-- package-lock.json                  # npm lock file
|   |-- package.json                       # npm package definitions
|   |-- README.md                          # Frontend documentation
|-- README.md                             # Project overview documentation
|-- LICENSE                               # License information
```
## Official Account
<p align="center">
    <img alt="ins" src="https://i.postimg.cc/jjg737v4/ins.jpg" width="250" height="250" style="margin-bottom: 10px;">
    <img alt="tiktlk" src="https://i.postimg.cc/ZqKNLcPq/tik.jpg" width="250" height="250" style="margin-bottom: 10px;">
</p>
