# 飞机货物自动化平衡管理系统

### Author：乔宇 & 刘宇涵

<p align="center">
    <img alt="logo" src="https://i.postimg.cc/HL5pVSkN/icon.png" width="150" height="150" style="margin-bottom: 10px;">
</p>

<p align="center">
<svg style="width:12px;height:12px;" t="1706099735946" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19568" width="200" height="200"><path d="M905.386667 226.133333L562.517333 28.842667c-31.744-18.773333-71.68-18.773333-102.912 0L117.589333 226.133333c-31.744 18.773333-51.882667 52.394667-51.882666 89.770667v395.434667c0 36.864 19.626667 70.485333 51.882666 89.770666L459.434667 998.4c15.701333 9.045333 33.28 13.653333 51.882666 13.653333 18.090667 0 35.84-5.12 51.882667-13.653333l342.357333-197.290667c31.744-18.773333 51.882667-52.394667 51.882667-89.770666V315.733333c-1.024-36.693333-20.821333-71.509333-52.053333-89.6z m-12.117334 484.010667c0 14.677333-7.509333 27.136-20.138666 34.816L531.114667 942.592c-12.117333 6.997333-27.136 6.997333-40.448 0L148.821333 744.96c-12.117333-6.997333-19.626667-20.138667-19.626666-34.816V315.733333c0-14.677333 7.509333-27.136 19.626666-34.816L491.349333 83.285333c5.973333-3.584 12.970667-5.461333 19.626667-5.461333 6.997333 0 13.653333 1.536 19.626667 5.461333l342.357333 197.290667c12.117333 6.997333 19.626667 20.138667 19.626667 34.816v394.410667l0.682666 0.341333z" fill="#1296db" p-id="19569"></path><path d="M469.411919 737.437712a25.6 39.936 31.185 1 0 41.357966-68.330484 25.6 39.936 31.185 1 0-41.357966 68.330484Z" fill="#1296db" p-id="19570"></path><path d="M609.949482 664.238808a25.6 39.936 31.185 1 0 41.357966-68.330484 25.6 39.936 31.185 1 0-41.357966 68.330484Z" fill="#1296db" p-id="19571"></path><path d="M733.489691 596.07907a25.6 39.936 31.185 1 0 41.357966-68.330484 25.6 39.936 31.185 1 0-41.357966 68.330484Z" fill="#1296db" p-id="19572"></path><path d="M646.144 241.152l-1.194667 0.512 1.194667-0.512-232.96 141.994667v117.76l-61.610667-39.253334v-112.981333l232.106667-141.824 0.853333-0.512-13.141333-7.338667-62.464-35.328-228.864 136.362667v207.36l206.165333 128 225.962667-132.266667V278.528z" fill="#1296db" p-id="19573"></path><path d="M712.362667 419.84v26.112l111.274666 61.44v90.453333L475.989333 788.309333c-10.24 5.632-22.698667 5.290667-32.597333-0.853333l-229.717333-140.288c-12.970667-7.850667-18.773333-23.893333-13.824-37.888 10.069333-28.672 32.256-50.858667 51.370666-65.536v-28.16c-23.381333 15.530667-58.368 44.544-73.045333 86.016-8.533333 24.234667 1.365333 51.541333 23.552 65.024l229.717333 140.288c8.874667 5.461333 18.773333 8.021333 28.842667 8.021333 9.216 0 18.261333-2.218667 26.624-6.826666L846.506667 611.498667v-117.589334L712.362667 419.84z" fill="#1296db" p-id="19574"></path><path d="M558.762667 192l110.592 62.122667-34.304 8.362666-122.197334-64.682666 25.088-4.437334z" fill="#1296db" p-id="19575"></path></svg>
  🇬🇧 <a href="README.md">English</a>
  &nbsp;
  🇨🇳 <a href="README.zh_CN.md">Chinese</a>
</p>

## 项目简介
Aircraft Cargo Balance System 是一个用于飞机货物平衡管理的开源系统。该系统致力于帮助航空公司和货运运营商有效地规划和管理飞机上的货物分布，确保在飞行过程中保持良好的平衡，以提高飞行安全性和燃油效率。
<p align="center">
    <img alt="Overview" src="https://i.postimg.cc/zfb8qf9Y/IMG-4687.avif" width="100%">
    <img alt="Overview" src="https://i.postimg.cc/KvxGtxgt/IMG-4689.avif" width="100%">
</p>

## 目的
这个项目的灵感来源于市场对飞机货物管理系统不断增长的需求，以及现有解决方案的局限性。“飞机货物自动平衡系统”采用最新的传感器技术和先进的数据处理算法，旨在提供一种比传统的人工平衡方法更准确和可靠的解决方案。

## 项目成员

| 姓名     | 邮箱                  | 贡献                                           | GitHub                          |
| -------- | --------------------- | ---------------------------------------------- | ------------------------------- |
| 乔宇    | [2908983Q@student.gla.ac.uk](mailto:2908983Q@student.gla.ac.uk) | 负责整个项目软件框架设计，前端整体开发，硬件开发                | [qiaoyu113](https://github.com/qiaoyu113)    |
| 刘宇涵    | [2859549l@student.gla.ac.uk](mailto:yuhanliu123@outlook.com) | 负责项目整体硬件框架设计，硬件及软件开发             | [yuhanliu123](https://github.com/yuhanliu123)    |
| 邓祎灵    | [2840572D@student.gla.ac.uk](mailto:2840572D@student.gla.ac.uk) | ...            | [YiLingDeng-97](https://github.com/YiLingDeng-97)    |
| 何宸章    | [2949931H@student.gla.ac.uk](mailto:2949931H@student.gla.ac.uk) | ...                | [zzzzzlian](https://github.com/zzzzzlian)    |


## 功能特性
1. 货物管理： 提供直观的界面，让用户轻松添加、删除和编辑飞机上的货物信息。
2. 平衡计算： 基于飞机型号和货物分布，计算飞机的重心和平衡情况，确保在各个飞行阶段保持合理的平衡。
3. 报告生成： 生成详细的平衡报告，包括重心图、荷载图等，以供飞行员和地勤人员参考。

## 技术架构
1. **树莓派 (Raspberry Pi)**
- **传感器接口**:通过GPIO接口连接传感器，实时检索货物重量数据。
- **数据处理**:使用c++进行数据处理，计算平衡条件并生成权重热图。
- **局域网服务器**:系统通过隧道将公网地址映射到本地IP地址，从而实现通过公网地址进行web前端访问。这样设置方便了WebSocket连接，允许GPIO组件和web前端实时访问API。

2. **GPIO 微控制器**
- **连接到树莓派**:通过GPIO连接与树莓派的硬件接口。连接之后，通过互斥锁管理与硬件的通信，允许根据特定的需求和命令进行按需通信。
- **输送带控制**:控制输送带电机实现实时平衡调节。
- **传感器接口**:连接货物传感器，获取实时货物位置信息。

3. **网页端 (Web)**
- **前端界面**:使用Vue构建，以创建一个显示实时货物平衡状态和重量热图的用户友好界面。
- **与树莓派通信**:使用WebSocket从树莓派获取实时数据。
- **用户显示**:利用重量传感器的实时读数向前端提供反馈，通过热分布图和平衡值为用户提供更直观的平衡视图。

## 项目视频展示
[![Watch the video](https://i.postimg.cc/mgnRSrL6/IMG-4691-2.jpg)](https://www.youtube.com/watch?v=BFPnpCT8uog)

## 安装教程
<p>
:exclamation: 后端: <a href="backend/readme.md">Raspberry PI environment installation address</a>
</p>
<p>
:exclamation: 前端: <a href="web/README.md">Web environment installation address</a>
</p>


## 3D Model Design
<p align="center">
    <img alt="Overview" src="https://i.postimg.cc/4dwDQj0w/IMG-4698.jpg" width="100%">
</p>

为了实现精准的货物重量测量与平衡，我们设计了一套详细的3D模型。该模型包括五个较小的称重板，它们是用来单独测量货物重量的关键组件。这些称重板将与重力传感器连接，从而捕捉货物的精确重量。为了保证测量的稳定性和准确性，我们还设计了一个较大的板子，其将被固定在传送带的底部中心。这个大板子不仅作为称重板的支撑结构，而且还起到连接重力传感器的作用，确保重力传感器可以准确地传递货物的重力信息。整个装置被牢固地固定在传送带上，以保持整个系统的稳定性，并确保在运输过程中货物重量的实时监控和平衡。

此3D设计图是我们项目不可或缺的一部分，它详细地展示了称重系统的组装方式和工作原理，是理解和实施我们货物平衡系统的重要参考资料。

## 项目预览
飞机货物自动平衡系统设计精确，以确保其组件之间的无缝集成和通信。该系统的核心是树莓派，它作为中央处理单元，编排命令流和数据流。
<p align="center">
    <img alt="Overview" src="https://i.postimg.cc/wvkPNz0Y/Wechat-IMG4222.png" width="100%">
</p>

- **树莓派**:这个紧凑但功能强大的板是我们系统的指挥中心。它直接连接到承载一组关键组件的面包板。

- **测压元件**:多个测压元件通过一组HX711放大器连接到树莓派。这些精密仪器负责测量货物的重量，并将这些数据转发回树莓派进行处理。

- **步进电机**:步进电机由TB6600微步驱动器驱动，将树莓派的命令转换为机械运动。这种设置对于调整传送带的位置至关重要，以确保货物在飞机内正确平衡。

- **电源**:坚固的密封铅酸蓄电池为电机驱动器提供必要的电源，确保系统运动部件可靠、连续运行。

- **GPIO连接**:树莓派利用它的GPIO引脚与HX711放大器建立直接通信线路。这有利于高速数据总线，这对实时重量感知和平衡调整至关重要。

- **互斥锁**:为了保持数据完整性和通信效率，互斥锁被实现。这些锁管理对树莓派资源的访问，确保每个通信实例都被无干扰地处理。

- **通信协议**:该系统混合使用串行通信和其他自定义协议，旨在优化树莓派和硬件组件之间的通信速度和可靠性。

<p align="center">
    <img alt="Overview" src="https://i.postimg.cc/c1FZ2H1h/Wechat-IMG5038.png" width="100%">
</p>
本项目的软件架构精心设计，以支持复杂的操作并确保代码的高可维护性和扩展性。核心组件包括Controller、WebSocketSession、WeightSensor接口及其实现，以及MotorDriver，这些组件共同工作以达成系统的业务需求。

在系统中，Controller类承担着协调传感器读取和电机控制的核心任务。它通过调用WeightSensor的实现来获取重量数据，并根据这些数据决定如何操作MotorDriver来调整载重平衡。这不仅体现了单一职责原则，也使得系统的业务逻辑清晰且集中。

WebSocketSession类管理与前端的实时通信，为用户界面提供实时数据更新，并接收来自用户界面的指令。这个类的设计简洁，确保了与前端的通信既高效又可靠。通过使用回调机制，系统能够在收到新的数据或命令时立即响应，提高了交互的实时性。

传感器逻辑通过WeightSensor接口抽象化，允许系统支持多种类型的传感器而无需修改控制逻辑，体现了开闭原则和里氏替换原则。每个具体的传感器类，如HX711Sensor，都实现了这一接口，保证了替换的灵活性和可扩展性。传感器数据的读取过程中广泛使用了回调函数，这样可以在数据准备好时立即处理，而无需轮询检查，从而优化了性能和响应速度。

MotorDriver类负责具体的电机控制逻辑，通过一组方法来启动、停止及调整电机的运行状态。这个类的设计允许将来可能对电机类型或控制策略的扩展，同时也避免了高层业务逻辑与低层硬件操作的直接耦合，符合依赖倒置原则。

系统内所有组件的互动都通过简洁且专注的接口进行，减少了模块间的直接依赖，易于理解和维护。此外，通过有效的内存管理策略和多线程安全措施，我们确保了应用的性能和稳定性。

通过这些设计和实现策略，项目不仅遵循了SOLID原则，还确保了系统架构的整体效能和未来的可持续发展。回调的广泛使用使得系统能够以事件驱动的方式高效处理实时数据和用户交互，提升了整体的响应速度和用户体验。

<p align="center">
    <img alt="Overview" src="https://i.postimg.cc/KvSgWF7w/Wechat-IMG3760.png" width="90%">
</p>

该图像展示了飞机货物平衡系统的复杂用户界面，展示了复杂的硬件传感器数据无缝转换为直观和视觉上引人入胜的显示。

- **重力平衡可视化**:这部分界面展示了一个实时动态表示飞机货物重量分布的3D条形图。每个杆的高度表示由相应的称重传感器测量的重量，提供飞机重心的视觉表示。此功能为用户提供即时的视觉线索，以平衡状态，使快速调整，如有必要。

- **输送机状态指示器**:这些指示器可以一目了然地了解输送机系统的运行状态。图标在不同的状态之间切换，如空闲、运行或警报，通知用户当前的功能状态。这种实时状态更新确保在需要注意的任何问题上及时通知用户。

- **平衡额定值表盘:**平衡额定值被描述为一个表盘规，为用户提供飞机横向平衡的模拟可视化。它提供了一个快速的参考，飞机是偏向左侧还是右侧，以及不平衡的严重程度。

## 项目框架及结构
```
Aircraft_Cargo_Balance_System/
|-- backend/                            # 后端应用程序代码
|   |-- app/                            # 应用逻辑
|   |   |-- balance_rate/               # 平衡率计算与调整
|   |   |   |-- balance_rate.cpp        # 管理平衡率调整
|   |   |   |-- balance_rate.hpp        # 平衡率功能头文件
|   |   |-- controller/                 # 控制器逻辑
|   |   |   |-- controller_lod.cpp      # 控制器细节层次逻辑
|   |   |   |-- controller_lod.hpp      # 控制器细节层次头文件
|   |   |   |-- controller.cpp          # 主控制器逻辑实现
|   |   |   |-- controller.hpp          # 控制器接口头文件
|   |   |-- conveyor_status/            # 传送带状态检查
|   |   |   |-- conveyor_status.cpp     # 传送带状态实现
|   |   |   |-- conveyor_status.hpp     # 传送带状态头文件
|   |   |-- led_control/                # LED 控制逻辑
|   |   |   |-- button.cpp              # LED 按钮互动
|   |   |   |-- button.hpp              # 按钮控制头文件
|   |   |   |-- led.cpp                 # LED 行为逻辑
|   |   |   |-- led.hpp                 # LED 操作头文件
|   |   |   |-- main.cpp                # LED 模块入口点
|   |   |-- motor_driver/               # 电机驱动管理
|   |   |   |-- motor/                  # 电机控制实现
|   |   |   |-- motor_driver/           # 电机驱动特定文件
|   |   |   |-- motor_driver_main.cpp   # 电机驱动主逻辑
|   |   |   |-- motor_driver.cpp        # 管理电机驱动操作
|   |   |   |-- motor_driver.hpp        # 电机驱动函数头文件
|   |   |-- stepping_motor/             # 步进电机控制
|   |   |   |-- alarm/                  # 步进电机报警管理
|   |   |   |   |-- alarm.cpp           # 管理报警功能
|   |   |   |   |-- alarm.hpp           # 报警功能头文件
|   |   |   |-- left/                   # 左移控制
|   |   |   |   |-- left.cpp            # 左移逻辑
|   |   |   |   |-- left.hpp            # 左移头文件
|   |   |   |-- pause/                  # 暂停功能
|   |   |   |   |-- pause.cpp           # 暂停逻辑
|   |   |   |   |-- pause.hpp           # 暂停控制头文件
|   |   |   |-- right/                  # 右移控制
|   |   |   |   |-- right.cpp           # 右移逻辑
|   |   |   |   |-- right.hpp           # 右移头文件
|   |   |-- weight_reader/              # 重量读取模块
|   |   |   |-- weight_reader.cpp       # 重量读取模块实现
|   |   |   |-- weight_reader.hpp       # 重量读取模块头文件
|   |   |-- weight_sensor/              # 重量传感器管理
|   |       |-- hx711_sensor/           # HX711 重量传感器逻辑
|   |       |   |-- hx711_sensor.cpp    # HX711 重量传感器实现
|   |       |   |-- hx711_sensor.hpp    # HX711 重量传感器头文件
|   |       |-- WeightSensor/           # 高级重量传感器操作
|   |       |   |-- WeightSensor.cpp    # 管理重量传感器操作
|   |       |   |-- WeightSensor.hpp    # WeightSensor 类头文件
|   |       |-- main.cpp                # 重量传感器模块主入口点
|   |-- build/                          # 构建相关文件
|   |   |-- CMakeFiles/                 # CMake 生成的
|   |   |-- cmake_install.cmake         # CMake 安装脚本
|   |   |-- CMakeCache.txt              # CMake 缓存文件
|   |   |-- Makefile                    # 生成的项目 Makefile
|   |-- include/                        # 后端头文件
|   |   |-- AbstractScale.h             # 比例抽象定义
|   |   |-- AdvancedHX711.h             # HX711 传感器高级操作
|   |   |-- common.h                    # 常见定义和函数
|   |   |-- GpioException.h             # GPIO 操作异常处理
|   |   |-- HX711.h                     # HX711 传感器基类定义
|   |   |-- IntegrityException.h        # 完整性检查异常
|   |   |-- Mass.h                      # 质量测量定义
|   |   |-- SimpleHX711.h               # HX711 传感器简化操作
|   |   |-- TimeoutException.h          # 超时异常处理
|   |   |-- Utility.h                   # 实用功能函数
|   |   |-- Value.h                     # 值表示定义
|   |   |-- ValueStack.h                # 值存储的堆栈实现
|   |   |-- Watcher.h                   # 观察者模式实现
|   |-- socket/                         # 套接字通信逻辑
|   |   |-- gpio_lock.hpp               # GPIO 锁定机制头文件
|   |   |-- main.cpp                    # 套接字通信主逻辑
|   |   |-- send_message.cpp            # 发送消息逻辑
|   |   |-- send_message.hpp            # 发送消息函数头文件
|   |   |-- server.cpp                  # 服务器端套接字通信处理
|   |   |-- websocket_session/          # WebSocket 会话管理
|   |       |-- websocket_session_button.cpp  # 管理按钮相关的 WebSocket 会话
|   |       |-- websocket_session_button.hpp  # 按钮 WebSocket 会话头文件
|   |       |-- websocket_session_main.cpp   # WebSocket 会话主逻辑
|   |       |-- websocket_session_main.hpp   # 主 WebSocket 会话头文件
|   |       |-- websocket_session.cpp        # 通用 WebSocket 会话管理
|   |       |-- websocket_session.hpp        # WebSocket 会话定义头文件
|   |-- tests/                           # 后端单元测试
|   |   |-- motor_driver_test.cpp        # 电机驱动模块测试
|   |   |-- weight_sensor_test.cpp       # 重量传感器功能测试
|   |-- utils/                           # 实用函数和类
|   |   |-- __init__.cpp                 # 实用模块初始化
|   |   |-- calculations.cpp             # 各种计算函数
|   |-- CMakeLists.txt                   # CMake 构建配置
|   |-- readme.md                        # 后端文档
|-- web/                                 # 前端应用程序代码 (此部分未做更改)
|   |-- node_modules/                    # npm 依赖项
|   |-- public/                          # 公共资产
|   |-- src/                             # 源代码
|   |   |-- assets/                      # 静态资源如图片、字体等
|   |   |-- components/                  # Vue 组件
|   |   |   |-- echart/                  # 图表组件
|   |   |   |   |-- bottom/              # 底部图表组件
|   |   |   |   |   |-- conveyorChart.vue  # 传送带图表组件
|   |   |   |   |-- balance.vue            # 平衡显示组件
|   |   |   |   |-- light.vue              # 光控制组件
|   |   |-- router/                        # 路由配置
|   |   |   |-- index.js                   # 路由设置
|   |   |-- store/                         # Vuex 存储
|   |   |   |-- index.js                   # 存储定义
|   |   |-- views/                         # Vue 页面组件
|   |       |-- index.vue                  # 主组件
|   |       |-- simulation.vue             # 模拟视图组件
|   |       |-- status.vue                 # 状态视图组件
|   |-- App.vue                            # 主 Vue 应用程序组件
|   |-- main.js                            # Vue 应用程序入口点
|   |-- .gitignore                         # 指定有意无视的未跟踪文件
|   |-- babel.config.js                    # Babel 配置
|   |-- package-lock.json                  # npm 锁文件
|   |-- package.json                       # npm 包定义
|   |-- README.md                          # 前端文档
|-- README.md                             # 项目概述文档
|-- LICENSE                               # 许可信息
```

## Project Management
我们使用github项目管理工具来规划2次迭代的项目，总共有53个任务。该项目的最终主要开发者是乔宇和刘宇涵。
项目管理地址：<a href="https://github.com/users/qiaoyu113/projects/1/views/2">Aircraft_Cargo_Blance_System Project Management Platform</a>
最终完成的任务数如下:
| Username    | Score |
|-------------|-------|
| Yu Qiao   | 39    |
| YiLing Deng | 6     |
| Yuhan Liu | 34    |
| Chanzhang He  | 8     |

## 关注我们
<p align="center">
    <img alt="ins" src="https://i.postimg.cc/jjg737v4/ins.jpg" width="250" height="250" style="margin-bottom: 10px;">
    <img alt="tiktlk" src="https://i.postimg.cc/ZqKNLcPq/tik.jpg" width="250" height="250" style="margin-bottom: 10px;">
</p>
